{"version":3,"sources":["utils/douban.js"],"names":["URI","fetch","require","fetchApi","type","params","find","page","count","search","start","city","getApp","data","currentCity","Object","assign","q","then","res","findOne","id","module","exports"],"mappings":";;AAAA,IAAMA,MAAM,iCAAZ;AACA,IAAMC,QAAQC,QAAQ,SAAR,CAAd;;AAEA;;;;;;;AAOA,SAASC,QAAT,CAAmBC,IAAnB,EAAyBC,MAAzB,EAAiC;AAC/B,SAAOJ,MAAMD,GAAN,EAAWI,IAAX,EAAiBC,MAAjB,CAAP;AACD;;AAED;;;;;;;;AAQA,SAASC,IAAT,CAAeF,IAAf,EAAwD;AAAA,MAAnCG,IAAmC,uEAA5B,CAA4B;AAAA,MAAzBC,KAAyB,uEAAjB,EAAiB;AAAA,MAAbC,MAAa,uEAAJ,EAAI;;AACtD,MAAMJ,SAAS,EAAEK,OAAO,CAACH,OAAO,CAAR,IAAaC,KAAtB,EAA6BA,OAAOA,KAApC,EAA2CG,MAAMC,SAASC,IAAT,CAAcC,WAA/D,EAAf;AACA,SAAOX,SAASC,IAAT,EAAeK,SAASM,OAAOC,MAAP,CAAcX,MAAd,EAAsB,EAAEY,GAAGR,MAAL,EAAtB,CAAT,GAAgDJ,MAA/D,EACJa,IADI,CACC;AAAA,WAAOC,IAAIN,IAAX;AAAA,GADD,CAAP;AAED;;AAED;;;;;AAKA,SAASO,OAAT,CAAkBC,EAAlB,EAAsB;AACpB,SAAOlB,SAAS,aAAakB,EAAtB,EACJH,IADI,CACC;AAAA,WAAOC,IAAIN,IAAX;AAAA,GADD,CAAP;AAED;;AAEDS,OAAOC,OAAP,GAAiB,EAAEjB,UAAF,EAAQc,gBAAR,EAAjB","file":"douban.js","sourcesContent":["const URI = 'https://api.douban.com/v2/movie'\r\nconst fetch = require('./fetch')\r\n\r\n/**\r\n * 抓取豆瓣电影特定类型的API\r\n * https://developers.douban.com/wiki/?title=movie_v2\r\n * @param  {String} type   类型，例如：'coming_soon'\r\n * @param  {Objece} params 参数\r\n * @return {Promise}       包含抓取任务的Promise\r\n */\r\nfunction fetchApi (type, params) {\r\n  return fetch(URI, type, params)\r\n}\r\n\r\n/**\r\n * 获取列表类型的数据\r\n * @param  {String} type   类型，例如：'coming_soon'\r\n * @param  {Number} page   页码\r\n * @param  {Number} count  页条数\r\n * @param  {String} search 搜索关键词\r\n * @return {Promise}       包含抓取任务的Promise\r\n */\r\nfunction find (type, page = 1, count = 20, search = '') {\r\n  const params = { start: (page - 1) * count, count: count, city: getApp().data.currentCity }\r\n  return fetchApi(type, search ? Object.assign(params, { q: search }) : params)\r\n    .then(res => res.data)\r\n}\r\n\r\n/**\r\n * 获取单条类型的数据\r\n * @param  {Number} id     电影ID\r\n * @return {Promise}       包含抓取任务的Promise\r\n */\r\nfunction findOne (id) {\r\n  return fetchApi('subject/' + id)\r\n    .then(res => res.data)\r\n}\r\n\r\nmodule.exports = { find, findOne }\r\n"]}